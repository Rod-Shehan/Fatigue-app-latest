(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{4229:function(t,e,r){Promise.resolve().then(r.bind(r,5756))},9376:function(t,e,r){"use strict";var s=r(5475);r.o(s,"useRouter")&&r.d(e,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(e,{useSearchParams:function(){return s.useSearchParams}})},5756:function(t,e,r){"use strict";r.d(e,{NewSheetRedirect:function(){return d}});var s=r(7437),i=r(2265),n=r(9376),a=r(7648),o=r(9827),u=r(1770),c=r(1884),h=r(2381);let l=()=>({day_label:"",date:"",truck_rego:"",destination:"",start_kms:null,end_kms:null,work_time:Array(48).fill(!1),breaks:Array(48).fill(!1),non_work:Array(48).fill(!1)});function d(){let t=(0,n.useRouter)(),e=(0,o.NL)(),r=(0,u.D)({mutationFn:()=>(0,c.nL)({driver_name:"",second_driver:"",driver_type:"solo",destination:"",week_starting:function(){let t=new Date,e=t.getDay(),r=new Date(t);return r.setDate(t.getDate()-e),r.toISOString().split("T")[0]}(),days:Array(7).fill(null).map(()=>l()),status:"draft"}),onSuccess:r=>{e.invalidateQueries({queryKey:["sheets"]}),t.replace("/sheets/".concat(r.id))}});(0,i.useEffect)(()=>{r.mutate()},[]);let d=r.error&&r.error.body,f=null==d?void 0:d.sheet_id;return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4 bg-slate-50 dark:bg-slate-950 px-4",children:[r.isPending&&(0,s.jsx)("p",{className:"text-slate-500 dark:text-slate-400",children:"Creating new sheet…"}),r.isSuccess&&(0,s.jsx)("p",{className:"text-slate-500 dark:text-slate-400",children:"Redirecting…"}),r.isError&&(0,s.jsxs)("div",{className:"max-w-md text-center space-y-3",children:[(0,s.jsx)("p",{className:"text-red-600 dark:text-red-400 font-medium",children:r.error instanceof Error?r.error.message:"Failed to create sheet."}),(0,s.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Complete and sign this week's sheet before starting next week."}),f&&(0,s.jsx)(a.default,{href:"/sheets/".concat(f),children:(0,s.jsx)(h.z,{variant:"outline",className:"mt-2",children:"Open this week's sheet"})}),(0,s.jsx)(a.default,{href:"/sheets",children:(0,s.jsx)(h.z,{variant:"ghost",children:"Back to sheets"})})]})]})}},2381:function(t,e,r){"use strict";r.d(e,{z:function(){return u}});var s=r(7437),i=r(2265),n=r(535),a=r(3448);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=i.forwardRef((t,e)=>{let{className:r,variant:i,size:n,...u}=t;return(0,s.jsx)("button",{className:(0,a.cn)(o({variant:i,size:n,className:r})),ref:e,...u})});u.displayName="Button"},1837:function(t,e,r){"use strict";async function s(t,e){let{method:r="GET",body:s,...i}=null!=e?e:{},n={...i,method:r,headers:{"Content-Type":"application/json",...i.headers},credentials:"include",...void 0!==s&&{body:JSON.stringify(s)}},a=await fetch("".concat("").concat(t),n);if(!a.ok){var o;let t=await a.json().catch(()=>({error:a.statusText})),e=Error(null!==(o=t.error)&&void 0!==o?o:"Request failed");throw e.body=t,e}if(204!==a.status)return a.json()}r.d(e,{h:function(){return i}});let i={compliance:{check:t=>s("/api/compliance/check",{method:"POST",body:t})},regos:{list:()=>s("/api/regos"),create:t=>s("/api/regos",{method:"POST",body:t}),update:(t,e)=>s("/api/regos/".concat(t),{method:"PATCH",body:e}),delete:t=>s("/api/regos/".concat(t),{method:"DELETE"})},drivers:{list:()=>s("/api/drivers"),create:t=>s("/api/drivers",{method:"POST",body:t}),update:(t,e)=>s("/api/drivers/".concat(t),{method:"PATCH",body:e}),delete:t=>s("/api/drivers/".concat(t),{method:"DELETE"})},sheets:{list:()=>s("/api/sheets"),get:t=>s("/api/sheets/".concat(t)),regoMaxEndKms:t=>s("/api/rego-kms?rego=".concat(encodeURIComponent(t))),create:t=>s("/api/sheets",{method:"POST",body:t}),update:(t,e)=>s("/api/sheets/".concat(t),{method:"PATCH",body:e}),delete:t=>s("/api/sheets/".concat(t),{method:"DELETE"}),exportPdfUrl:t=>"".concat("","/api/sheets/").concat(t,"/export")},users:{create:t=>s("/api/users",{method:"POST",body:t})}}},1884:function(t,e,r){"use strict";r.d(e,{nL:function(){return C},eI:function(){return j},r9:function(){return P},Gg:function(){return b},OX:function(){return O},Fy:function(){return k},Wn:function(){return x},o_:function(){return S}});var s=r(1837);let i="sheets",n="sheetsList",a="regos",o="pending";function u(){return new Promise((t,e)=>{let r=indexedDB.open("fatigue-offline",1);r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result),r.onupgradeneeded=t=>{let e=t.target.result;e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"}),e.objectStoreNames.contains(n)||e.createObjectStore(n,{keyPath:"key"}),e.objectStoreNames.contains(a)||e.createObjectStore(a,{keyPath:"key"}),e.objectStoreNames.contains(o)||e.createObjectStore(o,{keyPath:"id",autoIncrement:!0})}})}function c(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"readonly";return t.transaction(e,r).objectStore(e)}async function h(t){let e=await u();return new Promise((r,s)=>{let n=c(e,i).get(t);n.onsuccess=()=>{var t;return r(null!==(t=n.result)&&void 0!==t?t:null)},n.onerror=()=>s(n.error)})}async function l(t){let e=await u();return new Promise((r,s)=>{let n=c(e,i,"readwrite").put(t);n.onsuccess=()=>r(),n.onerror=()=>s(n.error)})}async function d(t){let e=await u();return new Promise((r,s)=>{let n=c(e,i,"readwrite").delete(t);n.onsuccess=()=>r(),n.onerror=()=>s(n.error)})}async function f(){let t=await u();return new Promise((e,r)=>{let s=c(t,n).get("list");s.onsuccess=()=>{var t,r;return e(null!==(r=null===(t=s.result)||void 0===t?void 0:t.value)&&void 0!==r?r:[])},s.onerror=()=>r(s.error)})}async function p(t){let e=await u();return new Promise((r,s)=>{let i=c(e,n,"readwrite").put({key:"list",value:t});i.onsuccess=()=>r(),i.onerror=()=>s(i.error)})}async function m(){let t=await u();return new Promise((e,r)=>{let s=c(t,a).get("regos");s.onsuccess=()=>{var t,r;return e(null!==(r=null===(t=s.result)||void 0===t?void 0:t.value)&&void 0!==r?r:[])},s.onerror=()=>r(s.error)})}async function y(t){let e=await u();return new Promise((r,s)=>{let i=c(e,a,"readwrite").put({key:"regos",value:t});i.onsuccess=()=>r(),i.onerror=()=>s(i.error)})}async function w(){let t=await u();return new Promise((e,r)=>{let s=c(t,o).getAll();s.onsuccess=()=>{var t;return e(null!==(t=s.result)&&void 0!==t?t:[])},s.onerror=()=>r(s.error)})}async function v(t){let e=await u(),r={...t,at:Date.now()};return new Promise((t,s)=>{let i=c(e,o,"readwrite").add(r);i.onsuccess=()=>t(),i.onerror=()=>s(i.error)})}async function g(t){let e=await u();return new Promise((r,s)=>{let i=c(e,o,"readwrite").delete(t);i.onsuccess=()=>r(),i.onerror=()=>s(i.error)})}function b(){return"undefined"!=typeof navigator&&navigator.onLine}async function x(){let t;if(!b())return{synced:0};let e=await w(),r=0;for(let i of e){let e=i.id;if(null!=e)try{if("update"===i.type)await s.h.sheets.update(i.sheetId,i.data),await l(await s.h.sheets.get(i.sheetId)),await g(e),r++;else if("create"===i.type){let n=await h(i.tempId),a=n?{driver_name:n.driver_name,second_driver:n.second_driver,driver_type:n.driver_type,destination:n.destination,last_24h_break:n.last_24h_break,week_starting:n.week_starting,days:n.days,status:n.status,signature:n.signature,signed_at:n.signed_at}:i.data,o=await s.h.sheets.create(a);await l(o),await d(i.tempId);let u=(await f()).filter(t=>t.id!==i.tempId);u.push(o),await p(u),await g(e),t={tempId:i.tempId,realId:o.id},r++}}catch(e){return{synced:r,error:e instanceof Error?e.message:"Sync failed",replacedTempId:t}}}return{synced:r,replacedTempId:t}}async function P(t){if(t.startsWith("local-")){let e=await h(t);if(e)return e;throw Error("Local sheet not found.")}if(b())try{let e=await s.h.sheets.get(t);return await l(e),e}catch(r){let e=await h(t);if(e)return e;throw Error("Sheet not found and not available offline.")}let e=await h(t);if(e)return e;throw Error("You're offline and this sheet isn't cached. Connect to load it.")}async function k(){if(b())try{let t=await s.h.sheets.list();return await p(t),t}catch(t){}return f()}async function S(t,e){let r=await h(t).catch(()=>null),s=r?{...r,...e,id:t}:{...e,id:t};await l(s);let i=t.startsWith("local-");if(i||await v({type:"update",sheetId:t,data:e}),b()&&!i&&(await x()).synced>0){let e=await h(t);if(e)return e}return s}async function C(t){if(b()){let e=await s.h.sheets.create(t);await l(e);let r=await f();return await p([...r,e]),e}let e="local-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),r={...t,id:e};await l(r);let i=await f();return await p([...i,r]),await v({type:"create",tempId:e,data:t}),r}async function O(){if(b())try{let t=await s.h.regos.list();return await y(t),t}catch(t){}return m()}async function j(){return(await w()).length}},3448:function(t,e,r){"use strict";r.d(e,{cn:function(){return n}});var s=r(1994),i=r(3335);function n(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return(0,i.m6)((0,s.W)(e))}},2894:function(t,e,r){"use strict";r.d(e,{R:function(){return o},m:function(){return a}});var s=r(8238),i=r(7989),n=r(1255),a=class extends i.F{#t;#e;#r;#s;constructor(t){super(),this.#t=t.client,this.mutationId=t.mutationId,this.#r=t.mutationCache,this.#e=[],this.state=t.state||o(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#e.includes(t)||(this.#e.push(t),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#e=this.#e.filter(e=>e!==t),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#e.length||("pending"===this.state.status?this.scheduleGc():this.#r.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(t){let e=()=>{this.#i({type:"continue"})},r={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=(0,n.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#i({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#i({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});let s="pending"===this.state.status,i=!this.#s.canStart();try{if(s)e();else{this.#i({type:"pending",variables:t,isPaused:i}),this.#r.config.onMutate&&await this.#r.config.onMutate(t,this,r);let e=await this.options.onMutate?.(t,r);e!==this.state.context&&this.#i({type:"pending",context:e,variables:t,isPaused:i})}let n=await this.#s.start();return await this.#r.config.onSuccess?.(n,t,this.state.context,this,r),await this.options.onSuccess?.(n,t,this.state.context,r),await this.#r.config.onSettled?.(n,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(n,null,t,this.state.context,r),this.#i({type:"success",data:n}),n}catch(e){try{await this.#r.config.onError?.(e,t,this.state.context,this,r)}catch(t){Promise.reject(t)}try{await this.options.onError?.(e,t,this.state.context,r)}catch(t){Promise.reject(t)}try{await this.#r.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this,r)}catch(t){Promise.reject(t)}try{await this.options.onSettled?.(void 0,e,t,this.state.context,r)}catch(t){Promise.reject(t)}throw this.#i({type:"error",error:e}),e}finally{this.#r.runNext(this)}}#i(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),s.Vr.batch(()=>{this.#e.forEach(e=>{e.onMutationUpdate(t)}),this.#r.notify({mutation:this,type:"updated",action:t})})}};function o(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},1770:function(t,e,r){"use strict";r.d(e,{D:function(){return h}});var s=r(2265),i=r(2894),n=r(8238),a=r(4112),o=r(5345),u=class extends a.l{#t;#n=void 0;#a;#o;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#u()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,o.VS)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#a,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(e.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#a?.state.status==="pending"&&this.#a.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#a?.removeObserver(this)}onMutationUpdate(t){this.#u(),this.#c(t)}getCurrentResult(){return this.#n}reset(){this.#a?.removeObserver(this),this.#a=void 0,this.#u(),this.#c()}mutate(t,e){return this.#o=e,this.#a?.removeObserver(this),this.#a=this.#t.getMutationCache().build(this.#t,this.options),this.#a.addObserver(this),this.#a.execute(t)}#u(){let t=this.#a?.state??(0,i.R)();this.#n={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#c(t){n.Vr.batch(()=>{if(this.#o&&this.hasListeners()){let e=this.#n.variables,r=this.#n.context,s={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#o.onSuccess?.(t.data,e,r,s)}catch(t){Promise.reject(t)}try{this.#o.onSettled?.(t.data,null,e,r,s)}catch(t){Promise.reject(t)}}else if(t?.type==="error"){try{this.#o.onError?.(t.error,e,r,s)}catch(t){Promise.reject(t)}try{this.#o.onSettled?.(void 0,t.error,e,r,s)}catch(t){Promise.reject(t)}}}this.listeners.forEach(t=>{t(this.#n)})})}},c=r(9827);function h(t,e){let r=(0,c.NL)(e),[i]=s.useState(()=>new u(r,t));s.useEffect(()=>{i.setOptions(t)},[i,t]);let a=s.useSyncExternalStore(s.useCallback(t=>i.subscribe(n.Vr.batchCalls(t)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),h=s.useCallback((t,e)=>{i.mutate(t,e).catch(o.ZT)},[i]);if(a.error&&(0,o.L3)(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:h,mutateAsync:a.mutate}}}},function(t){t.O(0,[851,21,648,971,117,744],function(){return t(t.s=4229)}),_N_E=t.O()}]);