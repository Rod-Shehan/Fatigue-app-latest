(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{6833:function(e,t,r){Promise.resolve().then(r.bind(r,4051))},4051:function(e,t,r){"use strict";r.d(t,{SheetsList:function(){return w}});var a=r(7437),s=r(2265),n=r(1713),i=r(7648),o=r(1884),l=r(2381),c=r(1597),d=r(4014),u=r(5176),h=r(9626),m=r(3459),f=r(7928),x=r(6848);function w(){let[e,t]=(0,s.useState)(null);(0,s.useEffect)(()=>{try{let e=sessionStorage.getItem("fatigue-last-sheet-id");e&&t(e)}catch(e){}},[]);let{data:r=[],isLoading:w}=(0,n.a)({queryKey:["sheets"],queryFn:()=>(0,o.Fy)()});return(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8 md:py-12",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)(c.m,{backHref:e?"/sheets/".concat(e):void 0,backLabel:e?"Current sheet":void 0,title:"Driver Fatigue Log",subtitle:"WA Commercial Vehicle Fatigue Management",icon:(0,a.jsx)(u.Z,{className:"w-5 h-5"}),actions:(0,a.jsx)(i.default,{href:"/sheets/new",children:(0,a.jsxs)(l.z,{className:"bg-slate-900 hover:bg-slate-800 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-100 gap-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"})," Start New Week"]})})})}),(0,a.jsx)("h2",{className:"text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-6",children:"Your Sheets"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 dark:text-slate-500 mb-4",children:"Complete and sign the current week's sheet before starting a new one."}),w&&(0,a.jsx)("div",{className:"flex justify-center py-20",children:(0,a.jsx)(m.Z,{className:"w-6 h-6 animate-spin text-slate-400 dark:text-slate-500"})}),!w&&0===r.length&&(0,a.jsxs)("div",{className:"text-center py-20",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(f.Z,{className:"w-7 h-7 text-slate-300 dark:text-slate-500"})}),(0,a.jsx)("p",{className:"text-slate-400 dark:text-slate-500 mb-1",children:"No fatigue sheets yet"}),(0,a.jsx)("p",{className:"text-sm text-slate-300 dark:text-slate-600",children:"Create your first weekly record"})]}),(0,a.jsx)("div",{className:"space-y-3",children:r.map(t=>{let r=null!==e&&t.id===e;return(0,a.jsx)("div",{className:"rounded-xl border-2 shadow-md transition-all ".concat(r?"bg-slate-100 dark:bg-slate-800 border-slate-500 dark:border-slate-400 ring-2 ring-slate-400/30 dark:ring-slate-300/20 hover:shadow-lg hover:border-slate-600 dark:hover:border-slate-300":"bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-700 hover:shadow-lg hover:border-slate-400 dark:hover:border-slate-600"),children:(0,a.jsxs)(i.default,{href:"/sheets/".concat(t.id),className:"flex items-center justify-between p-4 md:p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-slate-100 dark:bg-slate-700 flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-slate-800 dark:text-slate-200",children:t.driver_name||"Unnamed Driver"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-0.5",children:[t.week_starting&&(0,a.jsxs)("span",{className:"text-xs text-slate-400 dark:text-slate-500 font-mono",children:["Week of ",(0,d.WU)(new Date(t.week_starting),"dd MMM yyyy")]}),t.destination&&(0,a.jsxs)("span",{className:"text-xs text-slate-400 dark:text-slate-500",children:["â†’ ",t.destination]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"hidden md:inline text-sm font-mono text-slate-500 dark:text-slate-400",children:[t.days?t.days.reduce((e,t)=>e+.5*(t.work_time||[]).filter(Boolean).length,0):0,"h"]}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded border ".concat("completed"===t.status?"border-emerald-300 text-emerald-600":"border-slate-200 text-slate-400"),children:"completed"===t.status?"Done":"Draft"}),(0,a.jsx)(x.Z,{className:"w-4 h-4 text-slate-300"})]})]})},t.id)})})]})})}},1597:function(e,t,r){"use strict";r.d(t,{m:function(){return i}});var a=r(7437);r(2265);var s=r(7648),n=r(5485);function i(e){let{backHref:t,backLabel:r="Your Sheets",title:i,subtitle:o,icon:l,actions:c}=e;return(0,a.jsxs)("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between sm:flex-wrap mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-shrink-0",children:[null!=t?(0,a.jsx)(s.default,{href:t,className:"flex shrink-0 rounded-full text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 dark:focus:ring-offset-slate-900","aria-label":r,title:r,children:(0,a.jsx)("span",{className:"flex items-center justify-center min-w-10 min-h-10 w-10 h-10 sm:min-w-12 sm:min-h-12 sm:w-12 sm:h-12",children:(0,a.jsx)(n.Z,{className:"w-5 h-5 sm:w-6 sm:h-6",strokeWidth:2.25})})}):(0,a.jsx)("span",{className:"w-10 h-10 sm:w-12 sm:h-12 shrink-0","aria-hidden":!0}),(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[null!=l&&(0,a.jsx)("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-slate-900 dark:bg-slate-600 flex items-center justify-center text-white dark:text-slate-200 shrink-0",children:l}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h1",{className:"text-base sm:text-lg md:text-xl font-bold text-slate-800 dark:text-slate-100 truncate",children:i}),null!=o&&(0,a.jsx)("p",{className:"text-xs text-slate-400 dark:text-slate-500 truncate mt-0.5",children:o})]})]})]}),null!=c&&(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2 justify-start min-w-0 w-full sm:w-auto",children:c})]})}},2381:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var a=r(7437),s=r(2265),n=r(535),i=r(3448);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,...l}=e;return(0,a.jsx)("button",{className:(0,i.cn)(o({variant:s,size:n,className:r})),ref:t,...l})});l.displayName="Button"},1837:function(e,t,r){"use strict";async function a(e,t){let{method:r="GET",body:a,...s}=null!=t?t:{},n={...s,method:r,headers:{"Content-Type":"application/json",...s.headers},credentials:"include",...void 0!==a&&{body:JSON.stringify(a)}},i=await fetch("".concat("").concat(e),n);if(!i.ok){var o;let e=await i.json().catch(()=>({error:i.statusText})),t=Error(null!==(o=e.error)&&void 0!==o?o:"Request failed");throw t.body=e,t}if(204!==i.status)return i.json()}r.d(t,{h:function(){return s}});let s={compliance:{check:e=>a("/api/compliance/check",{method:"POST",body:e})},regos:{list:()=>a("/api/regos"),create:e=>a("/api/regos",{method:"POST",body:e}),update:(e,t)=>a("/api/regos/".concat(e),{method:"PATCH",body:t}),delete:e=>a("/api/regos/".concat(e),{method:"DELETE"})},drivers:{list:()=>a("/api/drivers"),create:e=>a("/api/drivers",{method:"POST",body:e}),update:(e,t)=>a("/api/drivers/".concat(e),{method:"PATCH",body:t}),delete:e=>a("/api/drivers/".concat(e),{method:"DELETE"})},sheets:{list:()=>a("/api/sheets"),get:e=>a("/api/sheets/".concat(e)),regoMaxEndKms:e=>a("/api/rego-kms?rego=".concat(encodeURIComponent(e))),create:e=>a("/api/sheets",{method:"POST",body:e}),update:(e,t)=>a("/api/sheets/".concat(e),{method:"PATCH",body:t}),delete:e=>a("/api/sheets/".concat(e),{method:"DELETE"}),exportPdfUrl:e=>"".concat("","/api/sheets/").concat(e,"/export")},users:{create:e=>a("/api/users",{method:"POST",body:e})}}},1884:function(e,t,r){"use strict";r.d(t,{nL:function(){return P},eI:function(){return S},r9:function(){return k},Gg:function(){return v},OX:function(){return _},Fy:function(){return j},Wn:function(){return b},o_:function(){return N}});var a=r(1837);let s="sheets",n="sheetsList",i="regos",o="pending";function l(){return new Promise((e,t)=>{let r=indexedDB.open("fatigue-offline",1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(s)||t.createObjectStore(s,{keyPath:"id"}),t.objectStoreNames.contains(n)||t.createObjectStore(n,{keyPath:"key"}),t.objectStoreNames.contains(i)||t.createObjectStore(i,{keyPath:"key"}),t.objectStoreNames.contains(o)||t.createObjectStore(o,{keyPath:"id",autoIncrement:!0})}})}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"readonly";return e.transaction(t,r).objectStore(t)}async function d(e){let t=await l();return new Promise((r,a)=>{let n=c(t,s).get(e);n.onsuccess=()=>{var e;return r(null!==(e=n.result)&&void 0!==e?e:null)},n.onerror=()=>a(n.error)})}async function u(e){let t=await l();return new Promise((r,a)=>{let n=c(t,s,"readwrite").put(e);n.onsuccess=()=>r(),n.onerror=()=>a(n.error)})}async function h(e){let t=await l();return new Promise((r,a)=>{let n=c(t,s,"readwrite").delete(e);n.onsuccess=()=>r(),n.onerror=()=>a(n.error)})}async function m(){let e=await l();return new Promise((t,r)=>{let a=c(e,n).get("list");a.onsuccess=()=>{var e,r;return t(null!==(r=null===(e=a.result)||void 0===e?void 0:e.value)&&void 0!==r?r:[])},a.onerror=()=>r(a.error)})}async function f(e){let t=await l();return new Promise((r,a)=>{let s=c(t,n,"readwrite").put({key:"list",value:e});s.onsuccess=()=>r(),s.onerror=()=>a(s.error)})}async function x(){let e=await l();return new Promise((t,r)=>{let a=c(e,i).get("regos");a.onsuccess=()=>{var e,r;return t(null!==(r=null===(e=a.result)||void 0===e?void 0:e.value)&&void 0!==r?r:[])},a.onerror=()=>r(a.error)})}async function w(e){let t=await l();return new Promise((r,a)=>{let s=c(t,i,"readwrite").put({key:"regos",value:e});s.onsuccess=()=>r(),s.onerror=()=>a(s.error)})}async function g(){let e=await l();return new Promise((t,r)=>{let a=c(e,o).getAll();a.onsuccess=()=>{var e;return t(null!==(e=a.result)&&void 0!==e?e:[])},a.onerror=()=>r(a.error)})}async function p(e){let t=await l(),r={...e,at:Date.now()};return new Promise((e,a)=>{let s=c(t,o,"readwrite").add(r);s.onsuccess=()=>e(),s.onerror=()=>a(s.error)})}async function y(e){let t=await l();return new Promise((r,a)=>{let s=c(t,o,"readwrite").delete(e);s.onsuccess=()=>r(),s.onerror=()=>a(s.error)})}function v(){return"undefined"!=typeof navigator&&navigator.onLine}async function b(){let e;if(!v())return{synced:0};let t=await g(),r=0;for(let s of t){let t=s.id;if(null!=t)try{if("update"===s.type)await a.h.sheets.update(s.sheetId,s.data),await u(await a.h.sheets.get(s.sheetId)),await y(t),r++;else if("create"===s.type){let n=await d(s.tempId),i=n?{driver_name:n.driver_name,second_driver:n.second_driver,driver_type:n.driver_type,destination:n.destination,last_24h_break:n.last_24h_break,week_starting:n.week_starting,days:n.days,status:n.status,signature:n.signature,signed_at:n.signed_at}:s.data,o=await a.h.sheets.create(i);await u(o),await h(s.tempId);let l=(await m()).filter(e=>e.id!==s.tempId);l.push(o),await f(l),await y(t),e={tempId:s.tempId,realId:o.id},r++}}catch(t){return{synced:r,error:t instanceof Error?t.message:"Sync failed",replacedTempId:e}}}return{synced:r,replacedTempId:e}}async function k(e){if(e.startsWith("local-")){let t=await d(e);if(t)return t;throw Error("Local sheet not found.")}if(v())try{let t=await a.h.sheets.get(e);return await u(t),t}catch(r){let t=await d(e);if(t)return t;throw Error("Sheet not found and not available offline.")}let t=await d(e);if(t)return t;throw Error("You're offline and this sheet isn't cached. Connect to load it.")}async function j(){if(v())try{let e=await a.h.sheets.list();return await f(e),e}catch(e){}return m()}async function N(e,t){let r=await d(e).catch(()=>null),a=r?{...r,...t,id:e}:{...t,id:e};await u(a);let s=e.startsWith("local-");if(s||await p({type:"update",sheetId:e,data:t}),v()&&!s&&(await b()).synced>0){let t=await d(e);if(t)return t}return a}async function P(e){if(v()){let t=await a.h.sheets.create(e);await u(t);let r=await m();return await f([...r,t]),t}let t="local-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),r={...e,id:t};await u(r);let s=await m();return await f([...s,r]),await p({type:"create",tempId:t,data:e}),r}async function _(){if(v())try{let e=await a.h.regos.list();return await w(e),e}catch(e){}return x()}async function S(){return(await g()).length}},3448:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var a=r(1994),s=r(3335);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}}},function(e){e.O(0,[851,21,648,91,728,971,117,744],function(){return e(e.s=6833)}),_N_E=e.O()}]);