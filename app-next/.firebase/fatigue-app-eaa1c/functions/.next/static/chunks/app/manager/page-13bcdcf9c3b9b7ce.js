(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{2248:function(e,t,s){Promise.resolve().then(s.bind(s,7985))},7985:function(e,t,s){"use strict";s.d(t,{ManagerView:function(){return N}});var a=s(7437),r=s(2265),n=s(7648),i=s(1597),l=s(9827),d=s(1713),o=s(1770),c=s(1837),h=s(2381),u=s(279),x=s(5060),m=s(5291),p=s(1715),f=s(6169),v=s(5176),g=s(6994);let b=(0,s(6471).Z)("FilePen",[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]]);var y=s(3459),w=s(4287),k=s(5465),j=s(6111);function N(){var e,t,s,N,_,S;let E=(0,l.NL)(),[C,T]=(0,r.useState)(""),[P,Z]=(0,r.useState)(null);(0,r.useEffect)(()=>{try{let e=sessionStorage.getItem("fatigue-last-sheet-id");e&&Z(e)}catch(e){}},[]);let[D,z]=(0,r.useState)({last_24h_break:"",driver_type:"solo",week_starting:"",destination:"",driver_name:"",second_driver:""}),{data:M=[],isLoading:q}=(0,d.a)({queryKey:["sheets"],queryFn:()=>c.h.sheets.list()}),{data:L,isLoading:O}=(0,d.a)({queryKey:["sheet",C],queryFn:()=>c.h.sheets.get(C),enabled:!!C});(0,r.useEffect)(()=>{var e,t,s,a,r,n;L&&L.id===C&&z({last_24h_break:null!==(e=L.last_24h_break)&&void 0!==e?e:"",driver_type:null!==(t=L.driver_type)&&void 0!==t?t:"solo",week_starting:null!==(s=L.week_starting)&&void 0!==s?s:"",destination:null!==(a=L.destination)&&void 0!==a?a:"",driver_name:null!==(r=L.driver_name)&&void 0!==r?r:"",second_driver:null!==(n=L.second_driver)&&void 0!==n?n:""})},[L,C]);let R=(0,o.D)({mutationFn:e=>c.h.sheets.update(C,e),onSuccess:()=>{E.invalidateQueries({queryKey:["sheet",C]}),E.invalidateQueries({queryKey:["sheets"]})}}),I=(0,o.D)({mutationFn:e=>c.h.sheets.delete(e),onSuccess:()=>{E.invalidateQueries({queryKey:["sheets"]}),E.invalidateQueries({queryKey:["sheet",C]}),T("")}}),V=L&&(D.last_24h_break!==(null!==(e=L.last_24h_break)&&void 0!==e?e:"")||D.driver_type!==(null!==(t=L.driver_type)&&void 0!==t?t:"solo")||D.week_starting!==(null!==(s=L.week_starting)&&void 0!==s?s:"")||D.destination!==(null!==(N=L.destination)&&void 0!==N?N:"")||D.driver_name!==(null!==(_=L.driver_name)&&void 0!==_?_:"")||D.second_driver!==(null!==(S=L.second_driver)&&void 0!==S?S:""));return(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8 md:py-12",children:[(0,a.jsx)(i.m,{backHref:C?"/sheets/".concat(C):P?"/sheets/".concat(P):"/sheets",backLabel:C||P?"Fatigue Record":"Your Sheets",title:"Manager",subtitle:"View sheets and compliance across drivers",icon:(0,a.jsx)(p.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap mb-6",children:[(0,a.jsx)(n.default,{href:"/manager/add-managers",children:(0,a.jsxs)(h.z,{variant:"outline",className:"gap-2 text-slate-600 dark:text-slate-300",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"})," Add Managers"]})}),(0,a.jsx)(n.default,{href:"/admin/regos",children:(0,a.jsxs)(h.z,{variant:"outline",className:"gap-2 text-slate-600 dark:text-slate-300",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4"})," Manage Regos"]})}),(0,a.jsx)(n.default,{href:"/drivers",children:(0,a.jsxs)(h.z,{variant:"outline",className:"gap-2 text-slate-600 dark:text-slate-300",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"})," Manage Drivers"]})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)(b,{className:"w-5 h-5 text-slate-500 dark:text-slate-400"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Edit sheet inputs"})]}),(0,a.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Select a sheet to edit driver-entered fields such as last 24 hour break date, driver type, week starting, and destination."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Sheet"}),(0,a.jsxs)(m.Ph,{value:C,onValueChange:e=>T(e),disabled:q,children:[(0,a.jsx)(m.i4,{className:"w-full max-w-md",children:(0,a.jsx)(m.ki,{placeholder:"Select a sheet…"})}),(0,a.jsx)(m.Bw,{children:M.map(e=>(0,a.jsx)(m.Ql,{value:e.id,children:function(e){let t=e.driver_name||"Draft",s=e.week_starting?new Date(e.week_starting+"T12:00:00").toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"}):"—";return"".concat(t," — week of ").concat(s)}(e)},e.id))})]})]}),C&&(0,a.jsx)(a.Fragment,{children:O?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-slate-500 text-sm py-4",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 animate-spin"}),"Loading sheet…"]}):(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 pt-2 border-t border-slate-100 dark:border-slate-700",children:[(0,a.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Last 24 hour break"}),(0,a.jsx)(u.I,{type:"date",value:D.last_24h_break,onChange:e=>z(t=>({...t,last_24h_break:e.target.value})),className:"h-9 font-mono max-w-xs"}),(0,a.jsx)("p",{className:"text-xs text-slate-400",children:"Date of last 24h rest; resets 17h and 72h rules. Leave empty if not set."})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Driver type"}),(0,a.jsxs)("div",{className:"flex rounded-lg border border-slate-200 dark:border-slate-600 overflow-hidden w-fit",children:[(0,a.jsx)("button",{type:"button",onClick:()=>z(e=>({...e,driver_type:"solo"})),className:"px-4 py-1.5 text-xs font-bold transition-colors ".concat("solo"===D.driver_type?"bg-slate-900 dark:bg-slate-600 text-white dark:text-slate-100":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700"),children:"Solo"}),(0,a.jsx)("button",{type:"button",onClick:()=>z(e=>({...e,driver_type:"two_up"})),className:"px-4 py-1.5 text-xs font-bold transition-colors border-l border-slate-200 dark:border-slate-600 ".concat("two_up"===D.driver_type?"bg-slate-900 dark:bg-slate-600 text-white dark:text-slate-100":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700"),children:"Two-Up"})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Week starting"}),(0,a.jsx)(u.I,{type:"date",value:D.week_starting,onChange:e=>z(t=>({...t,week_starting:e.target.value})),className:"h-9 font-mono"})]}),(0,a.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Driver name"}),(0,a.jsx)(u.I,{value:D.driver_name,onChange:e=>z(t=>({...t,driver_name:e.target.value})),placeholder:"Driver name",className:"h-9 max-w-xs"})]}),"two_up"===D.driver_type&&(0,a.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Second driver"}),(0,a.jsx)(u.I,{value:D.second_driver,onChange:e=>z(t=>({...t,second_driver:e.target.value})),placeholder:"Second driver name",className:"h-9 max-w-xs"})]}),(0,a.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[(0,a.jsx)(x._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Destination"}),(0,a.jsx)(u.I,{value:D.destination,onChange:e=>z(t=>({...t,destination:e.target.value})),placeholder:"Destination",className:"h-9 max-w-xs"})]}),(0,a.jsxs)("div",{className:"sm:col-span-2 flex items-center gap-3 pt-2",children:[(0,a.jsxs)(h.z,{onClick:()=>{C&&R.mutate({last_24h_break:D.last_24h_break||void 0,driver_type:D.driver_type,week_starting:D.week_starting||void 0,destination:D.destination||void 0,driver_name:D.driver_name||void 0,second_driver:D.second_driver||void 0})},disabled:!V||R.isPending,className:"gap-2",children:[R.isPending?(0,a.jsx)(y.Z,{className:"w-4 h-4 animate-spin"}):R.isSuccess?(0,a.jsx)(w.Z,{className:"w-4 h-4"}):(0,a.jsx)(k.Z,{className:"w-4 h-4"}),"Save changes"]}),R.isSuccess&&(0,a.jsx)("span",{className:"text-sm text-green-600",children:"Saved."}),R.isError&&(0,a.jsx)("span",{className:"text-sm text-red-600",children:R.error instanceof Error?R.error.message:"Save failed"}),(0,a.jsx)(n.default,{href:C?"/sheets/".concat(C):"/sheets",children:(0,a.jsx)(h.z,{variant:"outline",size:"sm",children:"Open sheet"})}),(0,a.jsxs)(h.z,{variant:"outline",size:"sm",className:"text-red-600 dark:text-red-400 border-red-200 dark:border-red-800 hover:bg-red-50 dark:hover:bg-red-950/50 hover:border-red-300 dark:hover:border-red-700 gap-1",disabled:I.isPending,onClick:()=>{C&&confirm("Delete this sheet? This cannot be undone.")&&I.mutate(C)},children:[I.isPending?(0,a.jsx)(y.Z,{className:"w-3 h-3 animate-spin"}):(0,a.jsx)(j.Z,{className:"w-3 h-3"}),"Delete sheet"]})]})]})})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6 text-center text-slate-500 dark:text-slate-400",children:[(0,a.jsx)("p",{className:"text-sm",children:"Manager dashboard and reporting will appear here."}),(0,a.jsx)("p",{className:"text-xs mt-2",children:"Use the back button to return to your sheets."})]})]})]})})}},1597:function(e,t,s){"use strict";s.d(t,{m:function(){return i}});var a=s(7437);s(2265);var r=s(7648),n=s(5485);function i(e){let{backHref:t,backLabel:s="Your Sheets",title:i,subtitle:l,icon:d,actions:o}=e;return(0,a.jsxs)("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between sm:flex-wrap mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-shrink-0",children:[null!=t?(0,a.jsx)(r.default,{href:t,className:"flex shrink-0 rounded-full text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 dark:focus:ring-offset-slate-900","aria-label":s,title:s,children:(0,a.jsx)("span",{className:"flex items-center justify-center min-w-10 min-h-10 w-10 h-10 sm:min-w-12 sm:min-h-12 sm:w-12 sm:h-12",children:(0,a.jsx)(n.Z,{className:"w-5 h-5 sm:w-6 sm:h-6",strokeWidth:2.25})})}):(0,a.jsx)("span",{className:"w-10 h-10 sm:w-12 sm:h-12 shrink-0","aria-hidden":!0}),(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[null!=d&&(0,a.jsx)("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-slate-900 dark:bg-slate-600 flex items-center justify-center text-white dark:text-slate-200 shrink-0",children:d}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h1",{className:"text-base sm:text-lg md:text-xl font-bold text-slate-800 dark:text-slate-100 truncate",children:i}),null!=l&&(0,a.jsx)("p",{className:"text-xs text-slate-400 dark:text-slate-500 truncate mt-0.5",children:l})]})]})]}),null!=o&&(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2 justify-start min-w-0 w-full sm:w-auto",children:o})]})}},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return d}});var a=s(7437),r=s(2265),n=s(535),i=s(3448);let l=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,...d}=e;return(0,a.jsx)("button",{className:(0,i.cn)(l({variant:r,size:n,className:s})),ref:t,...d})});d.displayName="Button"},279:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(7437),r=s(2265),n=s(3448);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},5060:function(e,t,s){"use strict";s.d(t,{_:function(){return i}});var a=s(7437),r=s(2265),n=s(3448);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("label",{ref:t,className:(0,n.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",s),...r})});i.displayName="Label"},5291:function(e,t,s){"use strict";s.d(t,{Bw:function(){return h},Ph:function(){return o},Ql:function(){return u},i4:function(){return c},ki:function(){return x}});var a=s(7437),r=s(2265),n=s(861),i=s(3289),l=s(9559),d=s(3448);let o=n.fC,c=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(n.xz,{ref:t,className:(0,d.cn)("flex h-9 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[r,(0,a.jsx)(n.JO,{asChild:!0,children:(0,a.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});c.displayName=n.xz.displayName;let h=r.forwardRef((e,t)=>{let{className:s,children:r,position:i="popper",...l}=e;return(0,a.jsx)(n.h_,{children:(0,a.jsx)(n.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow-md",s),position:i,...l,children:(0,a.jsx)(n.l_,{className:"p-1",children:r})})})});h.displayName=n.VY.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(n.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-slate-100 dark:focus:bg-slate-700 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(n.eT,{children:r})]})});u.displayName=n.ck.displayName;let x=n.B4},1837:function(e,t,s){"use strict";async function a(e,t){let{method:s="GET",body:a,...r}=null!=t?t:{},n={...r,method:s,headers:{"Content-Type":"application/json",...r.headers},credentials:"include",...void 0!==a&&{body:JSON.stringify(a)}},i=await fetch("".concat("").concat(e),n);if(!i.ok){var l;let e=await i.json().catch(()=>({error:i.statusText})),t=Error(null!==(l=e.error)&&void 0!==l?l:"Request failed");throw t.body=e,t}if(204!==i.status)return i.json()}s.d(t,{h:function(){return r}});let r={compliance:{check:e=>a("/api/compliance/check",{method:"POST",body:e})},regos:{list:()=>a("/api/regos"),create:e=>a("/api/regos",{method:"POST",body:e}),update:(e,t)=>a("/api/regos/".concat(e),{method:"PATCH",body:t}),delete:e=>a("/api/regos/".concat(e),{method:"DELETE"})},drivers:{list:()=>a("/api/drivers"),create:e=>a("/api/drivers",{method:"POST",body:e}),update:(e,t)=>a("/api/drivers/".concat(e),{method:"PATCH",body:t}),delete:e=>a("/api/drivers/".concat(e),{method:"DELETE"})},sheets:{list:()=>a("/api/sheets"),get:e=>a("/api/sheets/".concat(e)),regoMaxEndKms:e=>a("/api/rego-kms?rego=".concat(encodeURIComponent(e))),create:e=>a("/api/sheets",{method:"POST",body:e}),update:(e,t)=>a("/api/sheets/".concat(e),{method:"PATCH",body:t}),delete:e=>a("/api/sheets/".concat(e),{method:"DELETE"}),exportPdfUrl:e=>"".concat("","/api/sheets/").concat(e,"/export")},users:{create:e=>a("/api/users",{method:"POST",body:e})}}},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(1994),r=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}},6111:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6471).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6169:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6471).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])}},function(e){e.O(0,[851,21,648,91,71,971,117,744],function(){return e(e.s=2248)}),_N_E=e.O()}]);