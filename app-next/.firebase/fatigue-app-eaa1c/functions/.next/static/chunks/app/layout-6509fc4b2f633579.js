(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9222:function(e,t,r){Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,3156)),Promise.resolve().then(r.bind(r,9615))},3156:function(e,t,r){"use strict";r.d(t,{Providers:function(){return d}});var n=r(7437),a=r(605),i=r(2979),o=r(9827),s=r(2265),c=r(2513),u=r(1884);function l(){let{online:e,pendingCount:t}=function(){let e=(0,o.NL)(),[t,r]=(0,s.useState)("undefined"==typeof navigator||navigator.onLine),[n,a]=(0,s.useState)(0),i=async()=>{if(!(0,u.Gg)())return;let t=await (0,u.Wn)();if(t.replacedTempId){let{tempId:r,realId:n}=t.replacedTempId;window.location.pathname==="/sheets/".concat(r)&&(window.history.replaceState(null,"","/sheets/".concat(n)),e.invalidateQueries({queryKey:["sheet",n]}),e.invalidateQueries({queryKey:["sheets"]}))}t.synced>0&&(e.invalidateQueries({queryKey:["sheets"]}),e.invalidateQueries({queryKey:["sheet"]})),a(await (0,u.eI)())};return(0,s.useEffect)(()=>{let e=()=>{r(!0),i()},t=()=>r(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),(0,u.eI)().then(a),i(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{(0,u.eI)().then(a)},5e3);return()=>clearInterval(e)},[]),{online:t,pendingCount:n,runSync:i}}();return e&&0===t?null:(0,n.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 flex items-center justify-center gap-2 bg-amber-600 px-4 py-2 text-sm font-medium text-white shadow-lg",role:"status","aria-live":"polite",children:e?(0,n.jsxs)("span",{children:["Syncing ",t," change",1!==t?"s":"","…"]}):(0,n.jsx)("span",{children:"Offline — changes saved locally and will sync when you’re back online."})})}function d(e){let{children:t}=e,[r]=(0,s.useState)(()=>new i.S);return(0,n.jsx)(c.f,{children:(0,n.jsx)(a.SessionProvider,{children:(0,n.jsxs)(o.aH,{client:r,children:[t,(0,n.jsx)(l,{})]})})})}},2513:function(e,t,r){"use strict";r.d(t,{F:function(){return l},f:function(){return u}});var n=r(7437),a=r(2265);let i="fatigue-theme",o=(0,a.createContext)(null);function s(){return window.matchMedia("(prefers-color-scheme: dark)").matches}function c(e){let t=document.documentElement;e?t.classList.add("dark"):t.classList.remove("dark")}function u(e){let{children:t}=e,[r,u]=(0,a.useState)("system"),[l,d]=(0,a.useState)("light"),[f,h]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{h(!0);let e=localStorage.getItem(i);e&&("light"===e||"dark"===e||"system"===e)&&u(e)},[]),(0,a.useEffect)(()=>{if(!f)return;let e="system"===r?s():"dark"===r;d(e?"dark":"light"),c(e)},[r,f]),(0,a.useEffect)(()=>{if(!f)return;let e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{if("system"===r){let e=s();d(e?"dark":"light"),c(e)}};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[r,f]),(0,n.jsx)(o.Provider,{value:{theme:r,setTheme:e=>{u(e),localStorage.setItem(i,e);let t="system"===e?s():"dark"===e;d(t?"dark":"light"),c(t)},resolved:l},children:t})}function l(){let e=(0,a.useContext)(o);if(!e)throw Error("useTheme must be used within ThemeProvider");return e}},9615:function(e,t,r){"use strict";r.d(t,{ThemeToggleInLayout:function(){return i}});var n=r(7437),a=r(9547);function i(){return(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,n.jsx)(a.T,{})})}},9547:function(e,t,r){"use strict";r.d(t,{T:function(){return c}});var n=r(7437);r(2265);var a=r(595),i=r(572),o=r(2513),s=r(2381);function c(){let{resolved:e,setTheme:t}=(0,o.F)();return(0,n.jsx)(s.z,{variant:"ghost",size:"icon",className:"h-11 w-11 rounded-lg text-slate-600 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-slate-100",onClick:()=>t("dark"===e?"light":"dark"),title:"dark"===e?"Switch to light mode":"Switch to dark mode","aria-label":"dark"===e?"Switch to light mode":"Switch to dark mode",children:"dark"===e?(0,n.jsx)(a.Z,{className:"h-6 w-6"}):(0,n.jsx)(i.Z,{className:"h-6 w-6"})})}},2381:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(7437),a=r(2265),i=r(535),o=r(3448);let s=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,...c}=e;return(0,n.jsx)("button",{className:(0,o.cn)(s({variant:a,size:i,className:r})),ref:t,...c})});c.displayName="Button"},1837:function(e,t,r){"use strict";async function n(e,t){let{method:r="GET",body:n,...a}=null!=t?t:{},i={...a,method:r,headers:{"Content-Type":"application/json",...a.headers},credentials:"include",...void 0!==n&&{body:JSON.stringify(n)}},o=await fetch("".concat("").concat(e),i);if(!o.ok){var s;let e=await o.json().catch(()=>({error:o.statusText})),t=Error(null!==(s=e.error)&&void 0!==s?s:"Request failed");throw t.body=e,t}if(204!==o.status)return o.json()}r.d(t,{h:function(){return a}});let a={compliance:{check:e=>n("/api/compliance/check",{method:"POST",body:e})},regos:{list:()=>n("/api/regos"),create:e=>n("/api/regos",{method:"POST",body:e}),update:(e,t)=>n("/api/regos/".concat(e),{method:"PATCH",body:t}),delete:e=>n("/api/regos/".concat(e),{method:"DELETE"})},drivers:{list:()=>n("/api/drivers"),create:e=>n("/api/drivers",{method:"POST",body:e}),update:(e,t)=>n("/api/drivers/".concat(e),{method:"PATCH",body:t}),delete:e=>n("/api/drivers/".concat(e),{method:"DELETE"})},sheets:{list:()=>n("/api/sheets"),get:e=>n("/api/sheets/".concat(e)),regoMaxEndKms:e=>n("/api/rego-kms?rego=".concat(encodeURIComponent(e))),create:e=>n("/api/sheets",{method:"POST",body:e}),update:(e,t)=>n("/api/sheets/".concat(e),{method:"PATCH",body:t}),delete:e=>n("/api/sheets/".concat(e),{method:"DELETE"}),exportPdfUrl:e=>"".concat("","/api/sheets/").concat(e,"/export")},users:{create:e=>n("/api/users",{method:"POST",body:e})}}},1884:function(e,t,r){"use strict";r.d(t,{nL:function(){return P},eI:function(){return T},r9:function(){return x},Gg:function(){return b},OX:function(){return j},Fy:function(){return S},Wn:function(){return k},o_:function(){return E}});var n=r(1837);let a="sheets",i="sheetsList",o="regos",s="pending";function c(){return new Promise((e,t)=>{let r=indexedDB.open("fatigue-offline",1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(a)||t.createObjectStore(a,{keyPath:"id"}),t.objectStoreNames.contains(i)||t.createObjectStore(i,{keyPath:"key"}),t.objectStoreNames.contains(o)||t.createObjectStore(o,{keyPath:"key"}),t.objectStoreNames.contains(s)||t.createObjectStore(s,{keyPath:"id",autoIncrement:!0})}})}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"readonly";return e.transaction(t,r).objectStore(t)}async function l(e){let t=await c();return new Promise((r,n)=>{let i=u(t,a).get(e);i.onsuccess=()=>{var e;return r(null!==(e=i.result)&&void 0!==e?e:null)},i.onerror=()=>n(i.error)})}async function d(e){let t=await c();return new Promise((r,n)=>{let i=u(t,a,"readwrite").put(e);i.onsuccess=()=>r(),i.onerror=()=>n(i.error)})}async function f(e){let t=await c();return new Promise((r,n)=>{let i=u(t,a,"readwrite").delete(e);i.onsuccess=()=>r(),i.onerror=()=>n(i.error)})}async function h(){let e=await c();return new Promise((t,r)=>{let n=u(e,i).get("list");n.onsuccess=()=>{var e,r;return t(null!==(r=null===(e=n.result)||void 0===e?void 0:e.value)&&void 0!==r?r:[])},n.onerror=()=>r(n.error)})}async function w(e){let t=await c();return new Promise((r,n)=>{let a=u(t,i,"readwrite").put({key:"list",value:e});a.onsuccess=()=>r(),a.onerror=()=>n(a.error)})}async function m(){let e=await c();return new Promise((t,r)=>{let n=u(e,o).get("regos");n.onsuccess=()=>{var e,r;return t(null!==(r=null===(e=n.result)||void 0===e?void 0:e.value)&&void 0!==r?r:[])},n.onerror=()=>r(n.error)})}async function v(e){let t=await c();return new Promise((r,n)=>{let a=u(t,o,"readwrite").put({key:"regos",value:e});a.onsuccess=()=>r(),a.onerror=()=>n(a.error)})}async function y(){let e=await c();return new Promise((t,r)=>{let n=u(e,s).getAll();n.onsuccess=()=>{var e;return t(null!==(e=n.result)&&void 0!==e?e:[])},n.onerror=()=>r(n.error)})}async function g(e){let t=await c(),r={...e,at:Date.now()};return new Promise((e,n)=>{let a=u(t,s,"readwrite").add(r);a.onsuccess=()=>e(),a.onerror=()=>n(a.error)})}async function p(e){let t=await c();return new Promise((r,n)=>{let a=u(t,s,"readwrite").delete(e);a.onsuccess=()=>r(),a.onerror=()=>n(a.error)})}function b(){return"undefined"!=typeof navigator&&navigator.onLine}async function k(){let e;if(!b())return{synced:0};let t=await y(),r=0;for(let a of t){let t=a.id;if(null!=t)try{if("update"===a.type)await n.h.sheets.update(a.sheetId,a.data),await d(await n.h.sheets.get(a.sheetId)),await p(t),r++;else if("create"===a.type){let i=await l(a.tempId),o=i?{driver_name:i.driver_name,second_driver:i.second_driver,driver_type:i.driver_type,destination:i.destination,last_24h_break:i.last_24h_break,week_starting:i.week_starting,days:i.days,status:i.status,signature:i.signature,signed_at:i.signed_at}:a.data,s=await n.h.sheets.create(o);await d(s),await f(a.tempId);let c=(await h()).filter(e=>e.id!==a.tempId);c.push(s),await w(c),await p(t),e={tempId:a.tempId,realId:s.id},r++}}catch(t){return{synced:r,error:t instanceof Error?t.message:"Sync failed",replacedTempId:e}}}return{synced:r,replacedTempId:e}}async function x(e){if(e.startsWith("local-")){let t=await l(e);if(t)return t;throw Error("Local sheet not found.")}if(b())try{let t=await n.h.sheets.get(e);return await d(t),t}catch(r){let t=await l(e);if(t)return t;throw Error("Sheet not found and not available offline.")}let t=await l(e);if(t)return t;throw Error("You're offline and this sheet isn't cached. Connect to load it.")}async function S(){if(b())try{let e=await n.h.sheets.list();return await w(e),e}catch(e){}return h()}async function E(e,t){let r=await l(e).catch(()=>null),n=r?{...r,...t,id:e}:{...t,id:e};await d(n);let a=e.startsWith("local-");if(a||await g({type:"update",sheetId:e,data:t}),b()&&!a&&(await k()).synced>0){let t=await l(e);if(t)return t}return n}async function P(e){if(b()){let t=await n.h.sheets.create(e);await d(t);let r=await h();return await w([...r,t]),t}let t="local-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),r={...e,id:t};await d(r);let a=await h();return await w([...a,r]),await g({type:"create",tempId:t,data:e}),r}async function j(){if(b())try{let e=await n.h.regos.list();return await v(e),e}catch(e){}return m()}async function T(){return(await y()).length}},3448:function(e,t,r){"use strict";r.d(t,{cn:function(){return i}});var n=r(1994),a=r(3335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},2778:function(){}},function(e){e.O(0,[461,851,21,692,353,971,117,744],function(){return e(e.s=9222)}),_N_E=e.O()}]);