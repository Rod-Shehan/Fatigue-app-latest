(()=>{var e={};e.id=171,e.ids=[171],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},22528:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>o}),a(80158),a(13647),a(35866);var t=a(23191),r=a(88716),i=a(37922),l=a.n(i),n=a(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);a.d(s,d);let o=["",{children:["manager",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,80158)),"C:\\Users\\r_she\\Documents\\Fatigue app\\app-next\\src\\app\\manager\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,13647)),"C:\\Users\\r_she\\Documents\\Fatigue app\\app-next\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\r_she\\Documents\\Fatigue app\\app-next\\src\\app\\manager\\page.tsx"],x="/manager/page",m={require:a,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/manager/page",pathname:"/manager",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},87472:(e,s,a)=>{Promise.resolve().then(a.bind(a,90546))},90546:(e,s,a)=>{"use strict";a.d(s,{ManagerView:()=>N});var t=a(10326),r=a(17577),i=a(90434),l=a(82066),n=a(44976),d=a(20108),o=a(10119),c=a(18069),x=a(91664),m=a(41190),u=a(44794),h=a(29280),p=a(22032),g=a(45707),v=a(71266),f=a(31855);let b=(0,a(9664).Z)("FilePen",[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]]);var w=a(46721),y=a(85131),j=a(96451),k=a(37084);function N(){let e=(0,n.NL)(),[s,a]=(0,r.useState)(""),[N,_]=(0,r.useState)(null),[q,S]=(0,r.useState)({last_24h_break:"",driver_type:"solo",week_starting:"",destination:"",driver_name:"",second_driver:""}),{data:P=[],isLoading:C}=(0,d.a)({queryKey:["sheets"],queryFn:()=>c.h.sheets.list()}),{data:M,isLoading:Z}=(0,d.a)({queryKey:["sheet",s],queryFn:()=>c.h.sheets.get(s),enabled:!!s}),D=(0,o.D)({mutationFn:e=>c.h.sheets.update(s,e),onSuccess:()=>{e.invalidateQueries({queryKey:["sheet",s]}),e.invalidateQueries({queryKey:["sheets"]})}}),z=(0,o.D)({mutationFn:e=>c.h.sheets.delete(e),onSuccess:()=>{e.invalidateQueries({queryKey:["sheets"]}),e.invalidateQueries({queryKey:["sheet",s]}),a("")}}),F=M&&(q.last_24h_break!==(M.last_24h_break??"")||q.driver_type!==(M.driver_type??"solo")||q.week_starting!==(M.week_starting??"")||q.destination!==(M.destination??"")||q.driver_name!==(M.driver_name??"")||q.second_driver!==(M.second_driver??""));return t.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8 md:py-12",children:[t.jsx(l.m,{backHref:s?`/sheets/${s}`:N?`/sheets/${N}`:"/sheets",backLabel:s||N?"Fatigue Record":"Your Sheets",title:"Manager",subtitle:"View sheets and compliance across drivers",icon:t.jsx(p.Z,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap mb-6",children:[t.jsx(i.default,{href:"/manager/add-managers",children:(0,t.jsxs)(x.z,{variant:"outline",className:"gap-2 text-slate-600 dark:text-slate-300",children:[t.jsx(g.Z,{className:"w-4 h-4"})," Add Managers"]})}),t.jsx(i.default,{href:"/admin/regos",children:(0,t.jsxs)(x.z,{variant:"outline",className:"gap-2 text-slate-600 dark:text-slate-300",children:[t.jsx(v.Z,{className:"w-4 h-4"})," Manage Regos"]})}),t.jsx(i.default,{href:"/drivers",children:(0,t.jsxs)(x.z,{variant:"outline",className:"gap-2 text-slate-600 dark:text-slate-300",children:[t.jsx(f.Z,{className:"w-4 h-4"})," Manage Drivers"]})})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(b,{className:"w-5 h-5 text-slate-500 dark:text-slate-400"}),t.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Edit sheet inputs"})]}),t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Select a sheet to edit driver-entered fields such as last 24 hour break date, driver type, week starting, and destination."}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Sheet"}),(0,t.jsxs)(h.Ph,{value:s,onValueChange:e=>a(e),disabled:C,children:[t.jsx(h.i4,{className:"w-full max-w-md",children:t.jsx(h.ki,{placeholder:"Select a sheet…"})}),t.jsx(h.Bw,{children:P.map(e=>t.jsx(h.Ql,{value:e.id,children:function(e){let s=e.driver_name||"Draft",a=e.week_starting?new Date(e.week_starting+"T12:00:00").toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"}):"—";return`${s} — week of ${a}`}(e)},e.id))})]})]}),s&&t.jsx(t.Fragment,{children:Z?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-slate-500 text-sm py-4",children:[t.jsx(w.Z,{className:"w-4 h-4 animate-spin"}),"Loading sheet…"]}):(0,t.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 pt-2 border-t border-slate-100 dark:border-slate-700",children:[(0,t.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Last 24 hour break"}),t.jsx(m.I,{type:"date",value:q.last_24h_break,onChange:e=>S(s=>({...s,last_24h_break:e.target.value})),className:"h-9 font-mono max-w-xs"}),t.jsx("p",{className:"text-xs text-slate-400",children:"Date of last 24h rest; resets 17h and 72h rules. Leave empty if not set."})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Driver type"}),(0,t.jsxs)("div",{className:"flex rounded-lg border border-slate-200 dark:border-slate-600 overflow-hidden w-fit",children:[t.jsx("button",{type:"button",onClick:()=>S(e=>({...e,driver_type:"solo"})),className:`px-4 py-1.5 text-xs font-bold transition-colors ${"solo"===q.driver_type?"bg-slate-900 dark:bg-slate-600 text-white dark:text-slate-100":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Solo"}),t.jsx("button",{type:"button",onClick:()=>S(e=>({...e,driver_type:"two_up"})),className:`px-4 py-1.5 text-xs font-bold transition-colors border-l border-slate-200 dark:border-slate-600 ${"two_up"===q.driver_type?"bg-slate-900 dark:bg-slate-600 text-white dark:text-slate-100":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Two-Up"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Week starting"}),t.jsx(m.I,{type:"date",value:q.week_starting,onChange:e=>S(s=>({...s,week_starting:e.target.value})),className:"h-9 font-mono"})]}),(0,t.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Driver name"}),t.jsx(m.I,{value:q.driver_name,onChange:e=>S(s=>({...s,driver_name:e.target.value})),placeholder:"Driver name",className:"h-9 max-w-xs"})]}),"two_up"===q.driver_type&&(0,t.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Second driver"}),t.jsx(m.I,{value:q.second_driver,onChange:e=>S(s=>({...s,second_driver:e.target.value})),placeholder:"Second driver name",className:"h-9 max-w-xs"})]}),(0,t.jsxs)("div",{className:"space-y-1.5 sm:col-span-2",children:[t.jsx(u._,{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold",children:"Destination"}),t.jsx(m.I,{value:q.destination,onChange:e=>S(s=>({...s,destination:e.target.value})),placeholder:"Destination",className:"h-9 max-w-xs"})]}),(0,t.jsxs)("div",{className:"sm:col-span-2 flex items-center gap-3 pt-2",children:[(0,t.jsxs)(x.z,{onClick:()=>{s&&D.mutate({last_24h_break:q.last_24h_break||void 0,driver_type:q.driver_type,week_starting:q.week_starting||void 0,destination:q.destination||void 0,driver_name:q.driver_name||void 0,second_driver:q.second_driver||void 0})},disabled:!F||D.isPending,className:"gap-2",children:[D.isPending?t.jsx(w.Z,{className:"w-4 h-4 animate-spin"}):D.isSuccess?t.jsx(y.Z,{className:"w-4 h-4"}):t.jsx(j.Z,{className:"w-4 h-4"}),"Save changes"]}),D.isSuccess&&t.jsx("span",{className:"text-sm text-green-600",children:"Saved."}),D.isError&&t.jsx("span",{className:"text-sm text-red-600",children:D.error instanceof Error?D.error.message:"Save failed"}),t.jsx(i.default,{href:s?`/sheets/${s}`:"/sheets",children:t.jsx(x.z,{variant:"outline",size:"sm",children:"Open sheet"})}),(0,t.jsxs)(x.z,{variant:"outline",size:"sm",className:"text-red-600 dark:text-red-400 border-red-200 dark:border-red-800 hover:bg-red-50 dark:hover:bg-red-950/50 hover:border-red-300 dark:hover:border-red-700 gap-1",disabled:z.isPending,onClick:()=>{s&&confirm("Delete this sheet? This cannot be undone.")&&z.mutate(s)},children:[z.isPending?t.jsx(w.Z,{className:"w-3 h-3 animate-spin"}):t.jsx(k.Z,{className:"w-3 h-3"}),"Delete sheet"]})]})]})})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6 text-center text-slate-500 dark:text-slate-400",children:[t.jsx("p",{className:"text-sm",children:"Manager dashboard and reporting will appear here."}),t.jsx("p",{className:"text-xs mt-2",children:"Use the back button to return to your sheets."})]})]})]})})}},82066:(e,s,a)=>{"use strict";a.d(s,{m:()=>l});var t=a(10326);a(17577);var r=a(90434),i=a(9921);function l({backHref:e,backLabel:s="Your Sheets",title:a,subtitle:l,icon:n,actions:d}){return(0,t.jsxs)("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between sm:flex-wrap mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-shrink-0",children:[null!=e?t.jsx(r.default,{href:e,className:"flex shrink-0 rounded-full text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 dark:focus:ring-offset-slate-900","aria-label":s,title:s,children:t.jsx("span",{className:"flex items-center justify-center min-w-10 min-h-10 w-10 h-10 sm:min-w-12 sm:min-h-12 sm:w-12 sm:h-12",children:t.jsx(i.Z,{className:"w-5 h-5 sm:w-6 sm:h-6",strokeWidth:2.25})})}):t.jsx("span",{className:"w-10 h-10 sm:w-12 sm:h-12 shrink-0","aria-hidden":!0}),(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[null!=n&&t.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-slate-900 dark:bg-slate-600 flex items-center justify-center text-white dark:text-slate-200 shrink-0",children:n}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[t.jsx("h1",{className:"text-base sm:text-lg md:text-xl font-bold text-slate-800 dark:text-slate-100 truncate",children:a}),null!=l&&t.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 truncate mt-0.5",children:l})]})]})]}),null!=d&&t.jsx("div",{className:"flex flex-wrap items-center gap-2 justify-start min-w-0 w-full sm:w-auto",children:d})]})}},41190:(e,s,a)=>{"use strict";a.d(s,{I:()=>l});var t=a(10326),r=a(17577),i=a(51223);let l=r.forwardRef(({className:e,type:s,...a},r)=>t.jsx("input",{type:s,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));l.displayName="Input"},44794:(e,s,a)=>{"use strict";a.d(s,{_:()=>l});var t=a(10326),r=a(17577),i=a(51223);let l=r.forwardRef(({className:e,...s},a)=>t.jsx("label",{ref:a,className:(0,i.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...s}));l.displayName="Label"},29280:(e,s,a)=>{"use strict";a.d(s,{Bw:()=>x,Ph:()=>o,Ql:()=>m,i4:()=>c,ki:()=>u});var t=a(10326),r=a(17577),i=a(36363),l=a(14711),n=a(70744),d=a(51223);let o=i.fC,c=r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(i.xz,{ref:r,className:(0,d.cn)("flex h-9 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[s,t.jsx(i.JO,{asChild:!0,children:t.jsx(l.Z,{className:"h-4 w-4 opacity-50"})})]}));c.displayName=i.xz.displayName;let x=r.forwardRef(({className:e,children:s,position:a="popper",...r},l)=>t.jsx(i.h_,{children:t.jsx(i.VY,{ref:l,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow-md",e),position:a,...r,children:t.jsx(i.l_,{className:"p-1",children:s})})}));x.displayName=i.VY.displayName;let m=r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(i.ck,{ref:r,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-slate-100 dark:focus:bg-slate-700 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(i.wU,{children:t.jsx(n.Z,{className:"h-4 w-4"})})}),t.jsx(i.eT,{children:s})]}));m.displayName=i.ck.displayName;let u=i.B4},80158:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>n});var t=a(19510),r=a(58585),i=a(95456);let l=(0,a(68570).createProxy)(String.raw`C:\Users\r_she\Documents\Fatigue app\app-next\src\app\manager\manager-view.tsx#ManagerView`);async function n(){return await (0,i.SC)()||(0,r.redirect)("/sheets"),t.jsx(l,{})}},95456:(e,s,a)=>{"use strict";a.d(s,{Ad:()=>o,Lz:()=>n,SC:()=>c,gS:()=>d});var t=a(75571),r=a(13539),i=a(53797),l=a(20728);let n={adapter:(0,r.N)(l._),session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/login"},providers:[(0,i.Z)({name:"Email and password",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){let s=e?.email,a=e?.password;if(!s||!a)return null;let t=void 0;if(t&&a===t){let e=await l._.user.findUnique({where:{email:s}});return e||(e=await l._.user.create({data:{email:s,name:s.split("@")[0]}})),{id:e.id,email:e.email,name:e.name}}return null}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.id=s.id,e.email=s.email),e),session:async({session:e,token:s})=>(e.user&&(e.user.id=s.id),e)}};async function d(){let e=await (0,t.getServerSession)(n),s=e?.user&&"id"in e.user?e.user.id:void 0;return s?{session:e,userId:s,isManager:!!await c()}:null}function o(e,s){return!!s.isManager||e.createdById===s.userId}async function c(){let e=await (0,t.getServerSession)(n),s=e?.user?e.user.id:void 0;if(!s)return null;let a=await l._.user.findUnique({where:{id:s},select:{id:!0,email:!0,name:!0,role:!0}});return a?"manager"!==a.role&&await l._.user.findFirst({where:{role:"manager"},select:{id:!0}})?null:{session:e,user:a}:null}},20728:(e,s,a)=>{"use strict";a.d(s,{_:()=>r});let t=require("@prisma/client"),r=globalThis.prisma??new t.PrismaClient({log:["error"]})},37084:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(9664).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},45707:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(9664).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[276,637,492,833,894,999,562],()=>a(22528));module.exports=t})();